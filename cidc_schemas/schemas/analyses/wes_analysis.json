{
  "$schema": "metaschema/strict_meta_schema.json#",
  "$id": "wes_analysis",
  "title": "WES analysis combined files",
  "type": "object",
  "description": "Combined analysis files for the whole WES assay.",
  "additionalProperties": false,
  "properties": {
    "pair_runs": {
      "type": "array",
      "mergeStrategy": "arrayMergeById",
      "mergeOptions": {
        "$comment": "TODO fix to merge by a pair of normal and tumor ids. It requires improvements to the merge strategy code.",
        "idRef": "/run_id"
      },
      "items": {
        "description": "Whole Exome Sequencing assay output files for a tumor normal pair of samples.",
        "type": "object",
        "additionalProperties": false,

        "required": [
          "normal",
          "tumor",
          "run_id"
        ],
        "properties": {
          "normal": {
              "$ref": "assays/components/wes_sample_analysis.json"
          },
          "tumor": {
              "$ref": "assays/components/wes_sample_analysis.json"
          },
          "run_id": {
              "type": "string",
              "description": "An id used for a paired analysis run."
          },
          "somatic": {
            "description": "Somatic variant calling output sample files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "vcf_tnscope_filter": {
                "$ref": "artifacts/artifact_vcf.json"
              },
              "vcf_gz_tnscope_filter": {
                "$ref": "artifacts/artifact_vcf_gz.json"
              },
              "vcf_gz_tnscope_output": {
                "$ref": "artifacts/artifact_vcf_gz.json"
              },
              "vcf_tnscope_output": {
                "$ref": "artifacts/artifact_vcf.json"
              },
              "maf_tnscope_filter": {
                "$ref": "artifacts/artifact_maf.json"
              },
              "maf_tnscope_output": {
                "$ref": "artifacts/artifact_maf.json"
              },
              "tnscope_exons": {
                "$ref": "artifacts/artifact_vcf_gz.json"
              },
              "vcf_compare": {
                "$ref": "artifacts/artifact_text.json"
              }
            },
            "required": [
              "vcf_gz_tnscope_output",
              "vcf_gz_tnscope_filter",
              "maf_tnscope_output",
              "maf_tnscope_filter",
              "tnscope_exons",
              "vcf_compare"
            ]
          },
          "neoantigen": {
            "description": "Neoantigen output files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "HLA_results": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "combined_filtered": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "mhc_class_I_epitopes": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "mhc_class_II_epitopes": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "mhc_class_I_filtered_condensed_ranked": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "mhc_class_II_filtered_condensed_ranked": {
                "$ref": "artifacts/artifact_tsv.json"
              }
            },
            "required": [
              "HLA_results",
              "combined_filtered"
            ]
          },
          "copynumber": {
            "description": "Copy number output files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "copynumber_cnv_calls": {
                "$ref": "artifacts/artifact_text.json"
              },
              "copynumber_cnv_calls_tsv": {
                "$ref": "artifacts/artifact_tsv.json"
              }
            },
            "required": [
              "copynumber_cnv_calls",
              "copynumber_cnv_calls_tsv"
            ]
          },
          "purity": {
            "description": "Purity output files.",
            "type": "object",
            "additionalProperties": false,

            "required": [
              "optimal_purity_value"
            ],
            "properties": {
              "optimal_purity_value": {
                "$ref": "artifacts/artifact_text.json"
              }
            }
          },
          "clonality": {
            "description": "Clonality output files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "clonality_pyclone": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "clonality_table": {
                "$ref": "artifacts/artifact_tsv.json"
              }
            },
            "required": [
              "clonality_pyclone",
              "clonality_table"
            ]
          },
          "corealignments": {
            "description": "Core-alignments output files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "tn_corealigned": {
                "$ref": "artifacts/artifact_bam.json"
              },
              "tn_corealigned_index": {
                "$ref": "artifacts/artifact_bam_bai.json"
              }
            },
            "required": [
            ]
          },
          "report": {
            "description": "WES pipeline version/commit string.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "wes_version": {
                "$ref": "artifacts/artifact_text.json"
              },
              "config": {
                "$ref": "artifacts/artifact_yaml.json"
              },
              "wes_run_version": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "metasheet": {
                "$ref": "artifacts/artifact_csv.json"
              },
              "tumor_mutational_burden": {
                "$ref": "artifacts/artifact_tsv.json"
              },
              "report": {
                "$ref": "artifacts/artifact_gz.json"
              },
              "wes_sample_json": {
                "$ref": "artifacts/artifact_json.json"
              }
            },
            "required": [
              "config",
              "wes_run_version",
              "metasheet",
              "tumor_mutational_burden",
              "report",
              "wes_sample_json"
            ]
          },
          "msisensor": {
            "description": "MSISensor2 output files.",
            "type": "object",
            "additionalProperties": false,
            
            "properties": {
              "msisensor": {
                "$ref": "artifacts/artifact_text.json"
              }
            },
            "required": [
              "msisensor"
            ]
          }
        }
      }
    }
  }
}