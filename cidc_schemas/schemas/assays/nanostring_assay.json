{
  "$schema": "metaschema/strict_meta_schema.json#",
  "$id": "nanostring_assay",
  "title": "Nanostring Assay",
  "type": "object",
  "description": "A microarray assay for expression levels, suitable for smaller samples than RNA-seq",
  "additionalProperties": false,
  "mergeStrategy": "objectMerge",
  "definitions": {
    "run": {
      "type": "object",
      "description": "A single Nanostring run.",
      "additionalProperties": false,
      "required": ["run_id", "samples"],
      "properties": {
        "run_id": {
          "type": "string",
          "description": "A unique ID that separates the different runs of the given same sample."
        },
        "samples": {
          "type": "array",
          "mergeStrategy": "arrayMergeById",
          "mergeOptions": {
            "idRef": "cimac_id"
          },
          "items": {"$ref":"assays/nanostring_assay.json#definitions/sample"}
        },
        "control_raw_rcc": {
          "$ref": "artifacts/artifact_rcc.json",
          "$comment": "The RCC data file for a reference RNA sample"
        }
      }
    },

    "sample": {
      "type": "object",
      "description": "A data record for a single sample from a single Nanostring run.",
      "additionalProperties": false,
      "required": ["cimac_id", "raw_rcc"],
      "properties": {
        "cimac_id": {
            "$comment": "Id of a sample within this clinical trial, that this assay record is based upon.",
            "$ref": "sample.json#properties/cimac_id"
        },
        "raw_rcc": {
          "$ref": "artifacts/artifact_rcc.json",
          "$comment": "The RCC data file generated by Nanostring for the given sample in the given run."
        }
      }
    }
  },

  "properties": {
    "assay_creator": {
      "$ref": "assays/components/assay_core.json#properties/assay_creator"
    },
    "batch_id": {
      "type": "string",
      "description": "A unique ID that separates the different batches of Nanostring."
    },
    "data": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "normalized": {
          "$ref": "artifacts/artifact_csv.json"
        },
        "raw": {
          "$ref": "artifacts/artifact_csv.json"
        }
      }
    },
    "runs": {
      "type": "array",
      "mergeStrategy": "arrayMergeById",
      "mergeOptions": {
        "idRef": "/run_id"
      },
      "items": { "$ref": "assays/nanostring_assay.json#definitions/run" }
    }
  },
  "required": ["data", "runs"]
}
