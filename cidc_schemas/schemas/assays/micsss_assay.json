{
  "$schema": "metaschema/strict_meta_schema.json#",
  "$id": "micsss",
  "title": "MICSSS Assay",
  "type": "object",
  "description": "Multiplexed immunohistochemical consecutive staining on single slide.",
  "additionalProperties": false,

  "required": ["records"],
  "allOf": [
    { "$ref": "assays/components/assay_core.json" },
    { "$ref": "assays/components/image.json" },
    { "$ref": "assays/components/imaging_data.json" }
  ],
  "properties": {
    "assay_creator": {"$ref": "assays/components/assay_core.json#properties/assay_creator"},

    "slide_scanner_model": {"$ref": "assays/components/image.json#properties/slide_scanner_model"},
    "image_analysis_software": {"$ref": "assays/components/image.json#properties/image_analysis_software"},
    "image_analysis_software_version": {"$ref": "assays/components/image.json#properties/image_analysis_software_version"},
    "cell_segmentation_model": {"$ref": "assays/components/image.json#properties/cell_segmentation_model"},
    "positive_cell_detection": {"$ref": "assays/components/image.json#properties/positive_cell_detection"},

    "staining_date": {"$ref": "assays/components/imaging_data.json#properties/staining_date"},
    "imaging_date": {"$ref": "assays/components/imaging_data.json#properties/imaging_date"},
    "imaging_status": {"$ref": "assays/components/imaging_data.json#properties/imaging_status"},

    "records": {
      "type": "array",
      "description": "A single data record from micsss assay.",
      "items": {
        "type": "object",
        "additionalProperties": false,

        "required": ["project_qupath_folder", "micsss_exported_data_folder"],
        "properties": {
          "project_qupath_folder": {
            "description": "Folder path containing files produced from a QuPath image analysis.",
            "type": "string"
          },
          "micsss_exported_data_folder": {
            "description": "Folder path containing imaging files.",
            "type": "string"
          },
          
          "files": {
            "description": "micsss assay input files.",
            "type": "object",
            "additionalProperties": false,

            "properties": {
              "micsss_output_summary": {
                "$comment": "Summary of the results of the experiment.",
                "$ref": "artifacts/artifact_csv.json"
              },
              "Mapping Artifacts": {
                "type": "array",
                "description": "Regions of interest obtained from image mapping.",
                "items": { "$ref": "assays/components/mapping.json" }
              },
              "Composite Image Artifacts": {
                "type": "array",
                "description": "Regions of interest obtained from composite images.",
                "items": { "$ref": "assays/components/composite_image.json" }
              }
            }
          }
        }
      }
    },
    "antibody": {
      "type": "array",
      "items": {
        "description": "Data specific to antibody preparation on the multiplex immunohistochemical platform.",
        "type": "object",
        "additionalProperties": false,

        "required": ["primary_antibody_block"],
        "allOf": [{ "$ref": "assays/components/antibody.json" }],
        "properties": {
          "primary_antibody_block": {
            "description": "Blocking reagent used for primary antibody sample.",
            "type": "string"
          },
          "postPrimary_linker_block": {
            "description": "Linker block between the antibody and the therapeutic drug.",
            "type": "string"
          },
          "secondary_antibody_block": {
            "description": "Secondary antibody blocking reagent used for primary sample.",
            "type": "string"
          },
          "species": {
            "description": "Host species from which primary antibody sample was derived.",
            "type": "string"
          },
          "isotype": {
            "description": "Antibody isotype used to help differentiate non-specific background signal from specific antibody signal.",
            "type": "string"
          },
          "primary_antibody_dilution": {
            "description": "Concentration ratio of dilution buffer for primary antibody.",
            "type": "string"
          },
          "primary_antibody_incubation_time": {
            "description": "Time of primary antibody incubation.",
            "type": "string",
            "format": "time"
          },
          "primary_antibody_incubation_temp": {
            "description": "Temperature used for primary antibody incubation.",
            "type": "string"
          },
          "secondary_antibody": {
            "description": "Secondary antibody used to bind to primary antibody for detection assistance.",
            "type": "string"
          },
          "secondary_company": {
            "description": "Company from which secondary antibody sample was derived.",
            "type": "string"
          },
          "secondary_cat_num": {
            "description": "Antibody registry catalog number assigned to secondary antibody sample.",
            "type": "number"
          },
          "secondary_lot_num": {
            "description": "Identification number assigned to the particular quantity or lot of secondary antibody material from manufacturer.",
            "type": "number"
          },
          "secondary_antibody_dilution": {
            "description": "Concentration ratio of dilution buffer for secondary antibody prep.",
            "type": "string"
          },
          "secondary_antibody_incubation_time": {
            "description": "Temperature used for secondary antibody incubation.",
            "type": "string",
            "format": "time"
          },
          "ar_reagent": {
            "description": "Heating antigen retrieval reagents for tissue preparation.",
            "type": "string"
          },
          "ar_ph": {
            "description": "pH levels of reagents from heating antigen retrieval procedure.",
            "type": "string"
          },
          "ar_incubation_time": {
            "description": "Time of AR reagent incubation.",
            "type": "string",
            "format": "time"
          }
        }
      }
    }
  }
}
